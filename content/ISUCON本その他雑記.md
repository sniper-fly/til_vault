---
tags:
  - ISUCON
---

=========================
[[2024-09-06]]

`mysqldumpslow`コマンドでスロークエリの集計ログを見れる

ログのローテートをする意味?
→チューニング前後のログが混ざってしまい、結果の比較ができなくなる

EXPLAIN 文を利用すると実行計画を調べられる
EXPLAIN文の直後にこのように書く
```sql
EXPLAIN SELECT * FROM `comments` WHERE `post_id` = 9995 ORDER BY `created_at` DESC LIMIT 3;
```

```
+----+-------------+----------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra                       |
+----+-------------+----------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+
|  1 | SIMPLE      | comments | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 99918 |    10.00 | Using where; Using filesort |
+----+-------------+----------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+

key がNULLなのでインデックスは利用されておらず
rowsによって99918行の読み込みが必要になっている
```

abコマンドの実行結果はどこかに自動保存しておきたい
結果の比較が難しい

[[mysqlが作成するファイルの権限を設定する方法]]

nginxのプロセス番号はしょっちゅう変更されてしまう

dstat --cpu
で時系列でcpuの情報が取得できる
usr sys とかの読み方がわからない
19987
19616

=========================
[[2024-09-05]]

nginxのコンテナ内でnginxのconfigのsyntaxチェックを行う方法
`nginx -t`

mysql logのファイルの閲覧権限がおかしいので、my.cnfで744に出来るかどうか

nginx の再起動方法
```
nginx -s reopen
```
