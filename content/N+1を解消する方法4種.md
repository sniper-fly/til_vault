---
tags:
  - ISUCON
  - SQL
---

N+1を解消する方法4種
- memcachedなどのキャッシュを使う
1回目のクエリではN+1が発生する
2回目以降は保存したキャッシュから結果を返す

- 別クエリでのプリロード
例えばpostテーブルのuser_idが1,2,3,4...などのデータを探したい場合
予め大量のpostデータをselect
次にuserテーブルから、in句を使って検索をする

- JOINによる解決
シンプルにuser_idとidを使ってjoinして一回のクエリでほしいデータを取り出す

- SQLの正規化を崩し、JOINで欲しいデータをテーブルに追加する
データが冗長になる
更新時のコストが高くなる
クエリがシンプルになる