---
tags:
  - daily
---
## ISUCON
`mysqldumpslow`コマンド

ログのローテートをする意味?
→チューニング前後のログが混ざってしまい、結果の比較ができなくなる

show create table コマンドとは？
create tableをする際に必要なコマンドを表示することで、
テーブルの情報を知ることが出来る

EXPLAIN 文を利用すると実行計画を調べられる
EXPLAIN文の直後にこのように書く
```sql
EXPLAIN SELECT * FROM `comments` WHERE `post_id` = 9995 ORDER BY `created_at` DESC LIMIT 3;
```

```
+----+-------------+----------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra                       |
+----+-------------+----------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+
|  1 | SIMPLE      | comments | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 99918 |    10.00 | Using where; Using filesort |
+----+-------------+----------+------------+------+---------------+------+---------+------+-------+----------+-----------------------------+

key がNULLなのでインデックスは利用されておらず
rowsによって99918行の読み込みが必要になっている
```

インデックス作成文
```sql
ALTER TABLE comments ADD INDEX post_id_idx(post_id);
```

mysqlログファイルを削除したりなどファイルが更新されたことをMYSQLに伝えるコマンド
```bash
mysqladmin flush-logs
```

下記エラーが出る場合は
```
mysqladmin: connect to server at 'localhost' failed
error: 'Access denied for user 'root'@'localhost' (using password: NO)'
```

パスワード付きで実行する
```bash
mysqladmin flush-logs -p
```

abコマンドの実行結果はどこかに自動保存しておきたい
結果の比較が難しい

[MySQL :: MySQL 8.0 リファレンスマニュアル :: B.3.3.1 ファイル権限の問題](https://dev.mysql.com/doc/refman/8.0/ja/file-permissions.html)
UMASK環境変数を設定することで、生成されるファイルのパーミッションを変更できる
マスクと言いながら普通にchmodで設定する値と変わらない
つまり、644を作りたければ0644と設定する
0を先頭につけない場合は10進数とみなされる

44859 nginx
nginxのプロセス番号はしょっちゅう変更されてしまう

53592 mysqld
44601 bundle
44648 ruby
44355 memcached
topコマンドの表示の更新を一時停止するには？
Ctrl-s を使うとターミナルの表示が止まる
Ctrl-q で再開

top -p 53592 -p 44601 のように複数指定できる

dstat --cpu
で時系列でcpuの情報が取得できる
usr sys とかの読み方がわからない
19987
19616