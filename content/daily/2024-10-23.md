---
tags:
  - daily
---

## SQL
## type-challenge

## Frontend Mentor

## Zenn執筆

## 個人開発

## ISUCON
AMIを使ったISUCON環境の構築

セキュリティグループとは？
subnetやcredentialは必要なのか？

インスタンスの値段
[オンデマンドインスタンスの料金 - Amazon EC2 (仮想サーバー) | AWS](https://aws.amazon.com/jp/ec2/pricing/on-demand/)
|c7a.large|USD 0.1292|
|c7a.xlarge|USD 0.2584|

とりあえずAMIの起動とsshアクセス
キーペアはssh接続に必要なのか？
とりあえずファイヤウォールの設定に関しては良さそう

インスタンスの起動

秘密鍵の共有を行わなくても複数人でアクセスする方法がある
[AWSのEC2インスタンスに複数の端末からアクセスする #Ubuntu - Qiita](https://qiita.com/kota9/items/d54a70b542da09b0c099)

とりあえず秘密鍵の共有とファイアウォール設定だけでなんとかする
httpサーバーへのアクセスが可能か検証
httpアクセスが出来ない。そもそもグローバルIPが正しいのかもよくわからない

なにか手順が足りないのか？そもそもウェブサーバーが起動しているかどうか？
とりあえずisuconをawsで構築した人のブログを漁って足りない手順を見つける

インスタンスに設定されるセキュリティグループの設定に問題があった
SSHポートしか公開していなかったため、httpsの443を公開することでブラウザで表示可能に

ベンチマークインスタンスの起動とベンチマーク
起動手順は一緒

セキュリティグループのインバウンドルールの中にそのセキュリティグループ自体を指定することで、同じVPC、セキュリティグループに属する物同士が通信できるように

すべての ICMP - IPv4
をインバウンドルールで追加することでpingでの交信も可能

ベンチマークが最初からfailになってしまう
/etc/hosts とは？
自前のDNSみたいなもの
ホスト名をIPアドレスに変換する

>ベンチマーカーのIPアドレスが192.0.2.1なら、以下のコマンドを実行して`/etc/hosts`を変更する。
```shell
$ /home/isucon/add_hosts.sh 192.0.2.1
```
これはベンチマーカーではなく、アプリケーション側のインスタンスで実行する
指定するのは、ベンチマーマーカーのプライベートIP。
どうやらisucon9では、アプリケーションは外部サービスのAPIを利用するような格好になっているらしく、今回はベンチマーカーがその外部サービスの代替になっている模様。

なので、購入処理などはベンチマーカーインスタンスで何か起動しないとダメみたい。

golangで画像の静的ファイル化
https://github.com/regohiro/private-isu/commit/1a0676fb96da00e3ddd4016a9212023f9463a33c
https://github.com/regohiro/private-isu/commit/1c7ea1c77d780e7c2fade34007a66a1822de50fc

資料の検索
コードの解析、どちらの修正を選ぶか検討

[ISUCONの素振りで private-isu をやってGo実装で32万点までひとまず行った - stefafafan ...](https://blog.stenyan.jp/entry/2022/07/18/224212)
regohiroのはpostImageまで変更が及んでいた
対して上記リンクのものではgetImageしか変えていなかった

alpもしくはブラウザでの検証
実際に検証するとなったら

private-isuで作成した便利コマンド
`clear-mysql-slow  clear-nginx-access  pprof  pprof-check  view-mysql-slow`

nginxの設定を変更しても静的ファイルの配信が行われない
再起動ミス？むしろベンチマークが遅くなっている

nginxの設定を更新してブラウザで検証
nginxで指定したパスが間違っていた模様

[[nginxで静的ファイルを配信する設定ファイルの例]]

実際のディレクトリは
ディレクトリ名とパスに差異があるときの対応方法について

## Terraform / AWS

## React Testing

## その他
