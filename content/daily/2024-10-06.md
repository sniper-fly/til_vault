---
tags:
  - daily
---

## SQL
特定のキーをプライマリーにする
https://www.javadrive.jp/mysql/index/index4.html

テーブルのインデックスを整理して表示する
`show index from User`

## type-challenge

[[配列型を関数の引数に変換するには？]]
## ISUCON
プロセス・スレッド

PHP, Rubyはマルチプロセス、シングルスレッド
goroutine はシングルプロセス、マルチスレッドで軽量スレッドを使う
スレッドは同じプロセス上のメモリ空間を共有する

js, cssファイルは静的なので基本的にキャッシュしてもよい

nginxでの設定例
```
location /css/ {
	root /home/isucon/private_isu/webapp/public/;
}
location /js/ {
	root /home/isucon/private_isu/webapp/public/;
}
```

[[isucon本用語まとめ]]

ブラウザがgzipエンコーディングに対応していた場合はレスポンスを1/5ぐらいに圧縮できる
元々のファイルサイズが小さい場合はgzipすることで余計にサイズが大きくなることがある

静的なファイルは事前にgzip圧縮することでcpuの負担を下げられる

ウェブサーバーとアプリケーションサーバー間の通信もgzip圧縮すべき
これをしないとこれらの通信帯域を5倍消費することになる

>nginx はリクエスト・レスポンスをそれぞれバッファリングできるので、遅いクライアントがいた場合にもアプリケーションサーバーの処理がブロックされずに処理を行えます。

バッファリングとは？
遅いクライアントがいても、nginxなどのウェブサーバーが仲介となってデータを一時待機させる
アプリケーションサーバーはnginxとデータのやりとりすることに集中すればよく、クライアントの速度の遅い早いを気にすることなくフルに仕事ができる

アップストリームサーバーとのコネクション管理
コネクションを保持して使いまわしたい場合（キープアライブ）
設定例
```
location / {
	proxy_http_version 1.1;
	proxy_set_header Connection "";
	proxy_pass http://app;
}

upstream app {
	server localhost:8080;
	keepalive 32;
	keepalive_requests 10000;
}
```
大量のリクエストを受け付けるサーバーではコネクションの作り直しは負荷があがる

Linux の ss コマンドを利用して Linux 上で利用しているネットワークやソケットの情報を収集し、グラフ化することで TCP の様々な状態のコネクション数の変動を見る

TLS通信について
ssl_session_cache設定でセッション情報をキャッシュ可能
RSAよりECDSA鍵の方が安全・パフォーマンス高
HPACK→HTTP/2で登場したヘッダー圧縮技術
HTTP/2の方がパフォーマンス良い
AES-NI
TLS1.3

**カーネル空間**とは、コンピュータのOS（オペレーティングシステム）が動作している領域のことです。OSは、メモリやハードウェア（ディスクやネットワークカードなど）を管理しているので、その部分に直接アクセスできるのはカーネル（OSの核となる部分）だけです。

sendfile
通常、ファイルをネットワークを通じて送信する際、次のような流れになります：
1. ファイルの内容を**カーネル空間**から**ユーザー空間**にコピー
2. そのデータをユーザー空間で処理
3. ネットワークに送信するために、データを再度**カーネル空間**にコピー
しかし、このコピーの作業は無駄が多いです。そこで、**sendfile**というシステムコールを使うと、ファイルの内容をカーネル空間から直接ネットワークに送ることができ、データをユーザー空間にコピーする手間が省けます。これにより、処理が効率的になり、パフォーマンスが向上します。

tcp_nopush
`tcp_nopush` は、データを送信する際の効率化に役立つ設定です。これを有効にすると、小さいデータを何度も送信するのではなく、ある程度まとめて送ることができ、ネットワークの効率が良くなります。

キャッシュはプログラムが複雑になる

TTLとは？
Time To Live
キャッシュが保持される時間

キャッシュ実装双方
キャッシュにデータがなければキャッシュを生成して結果を保存する

紹介されている参考文献
詳解 HTTP/2
nginx 実践入門
プロフェッショナル SSL/TLS
