---
tags:
  - ISUCON
  - AWS
---

AMIを使ったISUCON環境の構築

セキュリティグループとは？
subnetやcredentialは必要なのか？

インスタンスの値段
[オンデマンドインスタンスの料金 - Amazon EC2 (仮想サーバー) | AWS](https://aws.amazon.com/jp/ec2/pricing/on-demand/)
|c7a.large|USD 0.1292|
|c7a.xlarge|USD 0.2584|

とりあえずAMIの起動とsshアクセス
キーペアはssh接続に必要なのか？
とりあえずファイヤウォールの設定に関しては良さそう

インスタンスの起動

秘密鍵の共有を行わなくても複数人でアクセスする方法がある
[AWSのEC2インスタンスに複数の端末からアクセスする #Ubuntu - Qiita](https://qiita.com/kota9/items/d54a70b542da09b0c099)

とりあえず秘密鍵の共有とファイアウォール設定だけでなんとかする
httpサーバーへのアクセスが可能か検証
httpアクセスが出来ない。そもそもグローバルIPが正しいのかもよくわからない

なにか手順が足りないのか？そもそもウェブサーバーが起動しているかどうか？
とりあえずisuconをawsで構築した人のブログを漁って足りない手順を見つける

インスタンスに設定されるセキュリティグループの設定に問題があった
SSHポートしか公開していなかったため、httpsの443を公開することでブラウザで表示可能に

ベンチマークインスタンスの起動とベンチマーク
起動手順は一緒

セキュリティグループのインバウンドルールの中にそのセキュリティグループ自体を指定することで、同じVPC、セキュリティグループに属する物同士が通信できるように

すべての ICMP - IPv4
をインバウンドルールで追加することでpingでの交信も可能

ベンチマークが最初からfailになってしまう
/etc/hosts とは？
自前のDNSみたいなもの
ホスト名をIPアドレスに変換する

>ベンチマーカーのIPアドレスが192.0.2.1なら、以下のコマンドを実行して`/etc/hosts`を変更する。
```shell
$ /home/isucon/add_hosts.sh 192.0.2.1
```
これはベンチマーカーではなく、アプリケーション側のインスタンスで実行する
指定するのは、ベンチマーマーカーのプライベートIP。
どうやらisucon9では、アプリケーションは外部サービスのAPIを利用するような格好になっているらしく、今回はベンチマーカーがその外部サービスの代替になっている模様。

なので、購入処理などはベンチマーカーインスタンスで何か起動しないとダメみたい。